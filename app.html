FROM node:18-alpine

WORKDIR /app

COPY package*.json ./
RUN npm ci --only=production

COPY . .

RUN npm run build

EXPOSE 3000

CMD ["npm", "start"]

=== package.json ===
{
  "name": "ai-joke-chat",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint"
  },
  "dependencies": {
    "next": "14.0.4",
    "react": "^18",
    "react-dom": "^18",
    "tailwindcss": "^3.3.0",
    "autoprefixer": "^10.0.1",
    "postcss": "^8"
  },
  "devDependencies": {
    "@types/node": "^20",
    "@types/react": "^18",
    "@types/react-dom": "^18",
    "eslint": "^8",
    "eslint-config-next": "14.0.4",
    "typescript": "^5"
  }
}

=== next.config.js ===
/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: true,
  swcMinify: true,
  images: {
    domains: ['localhost'],
  },
  env: {
    CUSTOM_KEY: process.env.CUSTOM_KEY,
  },
}

module.exports = nextConfig

=== postcss.config.js ===
module.exports = {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}

=== tailwind.config.js ===
/** @type {import('tailwindcss').Config} */
module.exports = {
  content: [
    './pages/**/*.{js,ts,jsx,tsx,mdx}',
    './components/**/*.{js,ts,jsx,tsx,mdx}',
  ],
  theme: {
    extend: {
      colors: {
        primary: '#4f46e5',
        secondary: '#7c3aed',
        accent: '#06b6d4',
        success: '#10b981',
        warning: '#f59e0b',
        error: '#ef4444',
        'bg-dark': '#0f172a',
        'bg-darker': '#020617',
        'bg-panel': 'rgba(30, 41, 59, 0.95)',
        'text-primary': '#f1f5f9',
        'text-secondary': '#94a3b8',
        'text-muted': '#64748b',
        'glass-bg': 'rgba(255, 255, 255, 0.03)',
        'glass-border': 'rgba(255, 255, 255, 0.1)',
      },
      backgroundImage: {
        'gradient-1': 'linear-gradient(135deg, #4f46e5 0%, #7c3aed 50%, #06b6d4 100%)',
        'gradient-2': 'linear-gradient(135deg, #7c3aed 0%, #4f46e5 100%)',
        'gradient-3': 'linear-gradient(135deg, #06b6d4 0%, #7c3aed 100%)',
      },
      animation: {
        'float': 'float 25s infinite ease-in-out',
        'pulse-slow': 'pulse 2s infinite',
        'blink': 'blink 2s infinite',
        'typing': 'typingDot 1.4s infinite ease-in-out',
        'recording': 'recording 1.5s infinite',
      },
      keyframes: {
        float: {
          '0%, 100%': { transform: 'translate(0, 0) scale(1)' },
          '25%': { transform: 'translate(150px, -100px) scale(1.1)' },
          '50%': { transform: 'translate(-100px, 150px) scale(0.9)' },
          '75%': { transform: 'translate(100px, 100px) scale(1.05)' },
        },
        blink: {
          '0%, 100%': { opacity: '1' },
          '50%': { opacity: '0.3' },
        },
        typingDot: {
          '0%, 60%, 100%': { transform: 'translateY(0)', opacity: '0.7' },
          '30%': { transform: 'translateY(-12px)', opacity: '1' },
        },
        recording: {
          '0%, 100%': { boxShadow: '0 0 0 0 rgba(239, 68, 68, 0.7)' },
          '50%': { boxShadow: '0 0 0 15px rgba(239, 68, 68, 0)' },
        },
      },
    },
  },
  plugins: [],
}

=== pages/_app.js ===
import '../styles/globals.css'

function MyApp({ Component, pageProps }) {
  return <Component {...pageProps} />
}

export default MyApp

=== styles/globals.css ===
@import 'tailwindcss/base';
@import 'tailwindcss/components';
@import 'tailwindcss/utilities';

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  background: #020617;
  color: #f1f5f9;
  height: 100vh;
  overflow: hidden;
  position: relative;
}

.bg-animation {
  position: fixed;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  z-index: -1;
  opacity: 0.3;
}

.bg-animation::before {
  content: '';
  position: absolute;
  width: 600px;
  height: 600px;
  background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 50%, #06b6d4 100%);
  border-radius: 50%;
  filter: blur(120px);
  animation: float 25s infinite ease-in-out;
}

.bg-animation::after {
  content: '';
  position: absolute;
  width: 500px;
  height: 500px;
  background: linear-gradient(135deg, #7c3aed 0%, #4f46e5 100%);
  border-radius: 50%;
  filter: blur(100px);
  animation: float 30s infinite ease-in-out reverse;
  right: -250px;
  bottom: -250px;
}

@keyframes float {
  0%, 100% {
    transform: translate(0, 0) scale(1);
  }
  25% {
    transform: translate(150px, -100px) scale(1.1);
  }
  50% {
    transform: translate(-100px, 150px) scale(0.9);
  }
  75% {
    transform: translate(100px, 100px) scale(1.05);
  }
}

/* Scrollbar styles */
.custom-scrollbar::-webkit-scrollbar {
  width: 8px;
}

.custom-scrollbar::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

.custom-scrollbar::-webkit-scrollbar-thumb {
  background: linear-gradient(135deg, rgba(79, 70, 229, 0.6), rgba(124, 58, 237, 0.6));
  border-radius: 4px;
}

=== components/Message.jsx ===
import React from 'react';

const Message = ({ text, sender, time, onSpeak }) => {
  const isUser = sender === 'user';
  const avatar = isUser ? 'üë§' : 'ü§ñ';

  return (
    <div className={`message mb-6 animate-slideIn ${isUser ? 'user-message' : 'bot-message'}`}>
      <style jsx>{`
        @keyframes slideIn {
          from {
            opacity: 0;
            transform: translateY(30px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        .animate-slideIn {
          animation: slideIn 0.4s ease-out;
        }
      `}</style>
      <div className="flex gap-4 items-start">
        <div className={`w-12 h-12 rounded-full flex items-center justify-center font-bold flex-shrink-0 text-xl ${
          isUser 
            ? 'bg-gradient-to-br from-cyan-500 to-purple-600 shadow-lg shadow-cyan-500/40' 
            : 'bg-gradient-to-br from-purple-600 to-purple-800 shadow-lg shadow-purple-600/40'
        }`}>
          {avatar}
        </div>
        <div className={`flex-1 p-5 rounded-2xl max-w-[75%] shadow-lg ${
          isUser
            ? 'bg-gradient-to-br from-cyan-500/25 to-purple-600/25 border border-cyan-500/40 ml-auto'
            : 'bg-gradient-to-br from-purple-600/25 to-purple-800/25 border border-purple-600/40'
        }`}>
          <div className="text-base leading-relaxed whitespace-pre-wrap break-words">
            {text}
          </div>
          <div className="text-xs text-gray-500 mt-3 flex items-center gap-2">
            <span>{time}</span>
            {!isUser && (
              <div className="ml-auto">
                <button
                  onClick={() => onSpeak(text)}
                  className="w-7 h-7 rounded-full bg-gray-800/30 border border-gray-700 text-gray-400 hover:bg-purple-600/20 hover:border-purple-500 hover:text-purple-400 transition-all duration-300 flex items-center justify-center"
                  title="Speak"
                >
                  üîä
                </button>
              </div>
            )}
          </div>
        </div>
      </div>
    </div>
  );
};

export default Message;

=== components/TypingIndicator.jsx ===
import React from 'react';

const TypingIndicator = () => {
  return (
    <div className="message mb-4">
      <div className="flex gap-4 items-start">
        <div className="w-12 h-12 rounded-full flex items-center justify-center font-bold flex-shrink-0 text-xl bg-gradient-to-br from-purple-600 to-purple-800 shadow-lg shadow-purple-600/40">
          ü§ñ
        </div>
        <div className="flex-1 p-4 rounded-2xl bg-gradient-to-br from-purple-600/25 to-purple-800/25 border border-purple-600/40 shadow-lg">
          <div className="flex gap-1.5 items-center">
            <div className="w-2.5 h-2.5 bg-purple-600 rounded-full animate-typing shadow-lg shadow-purple-600/60"></div>
            <div className="w-2.5 h-2.5 bg-purple-600 rounded-full animate-typing shadow-lg shadow-purple-600/60" style={{ animationDelay: '0.2s' }}></div>
            <div className="w-2.5 h-2.5 bg-purple-600 rounded-full animate-typing shadow-lg shadow-purple-600/60" style={{ animationDelay: '0.4s' }}></div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default TypingIndicator;

=== components/Header.jsx ===
import React from 'react';

const Header = ({ isConnected }) => {
  return (
    <header className="bg-gray-800/95 backdrop-blur-lg px-8 py-6 border-b border-gray-700 relative z-100 shadow-lg shadow-purple-600/10">
      <div className="max-w-7xl mx-auto flex justify-between items-center flex-wrap gap-4">
        <div className="flex items-center gap-4">
          <div className="w-11 h-11 bg-gradient-to-br from-purple-600 via-purple-700 to-cyan-500 rounded-xl flex items-center justify-center text-2xl animate-pulse-slow shadow-lg shadow-purple-600/50">
            ü§ñ
          </div>
          <h1 className="text-2xl font-bold bg-gradient-to-r from-purple-600 via-purple-700 to-cyan-500 bg-clip-text text-transparent">
            AI Joke Assistant
          </h1>
        </div>
        <div className="flex items-center gap-4">
          <div className="flex items-center gap-3 px-6 py-3 bg-purple-600/10 border border-purple-600/30 rounded-full font-medium">
            <div className={`w-2.5 h-2.5 rounded-full animate-blink ${
              isConnected ? 'bg-green-500 shadow-lg shadow-green-500/80' : 'bg-red-500 shadow-lg shadow-red-500/80'
            }`}></div>
            <span>{isConnected ? 'Connected' : 'Ready'}</span>
          </div>
          <a 
            href="https://huggingface.co/spaces/akhaliq/anycoder" 
            className="text-cyan-400 hover:text-purple-600 font-medium text-sm transition-all duration-300 hover:shadow-lg hover:shadow-cyan-400/50"
            target="_blank"
            rel="noopener noreferrer"
          >
            Built with anycoder
          </a>
        </div>
      </div>
    </header>
  );
};

export default Header;

=== components/SidePanel.jsx ===
import React from 'react';

const SidePanel = ({ 
  messageCount, 
  apiCallCount, 
  sessionTime,
  onQuickPrompt,
  onClearChat,
  onExportChat
}) => {
  const quickPrompts = [
    { icon: 'üòÇ', label: 'Tell me a dad joke', prompt: 'Tell me a funny dad joke' },
    { icon: 'üé≠', label: 'Knock knock joke', prompt: 'Tell me a knock knock joke' },
    { icon: 'üë®‚Äçüíº', label: 'Office humor', prompt: 'Tell me a joke about office life' },
    { icon: 'üê∂', label: 'Animal jokes', prompt: 'Tell me a funny animal joke' },
    { icon: 'ü§ì', label: 'Nerd jokes', prompt: 'Tell me a nerdy tech joke' },
    { icon: 'üçï', label: 'Food jokes', prompt: 'Tell me a funny food joke' },
  ];

  return (
    <aside className="w-80 bg-gray-800/95 backdrop-blur-lg rounded-2xl border border-gray-700 p-6 overflow-y-auto custom-scrollbar shadow-lg shadow-purple-600/15">
      <div className="mb-8">
        <div className="bg-purple-600/10 border border-purple-600/30 rounded-xl p-4 mb-6 text-sm leading-relaxed text-gray-400">
          <strong className="text-gray-200">üé≠ Welcome!</strong> I'm your personal joke assistant! Click any category below or type your own request. I'll serve up fresh jokes that will make you laugh!
        </div>

        <h3 className="text-xs uppercase tracking-wider text-gray-500 mb-4 flex items-center gap-2">
          <span>üí°</span> Quick Joke Categories
        </h3>
        <div className="flex flex-col gap-3">
          {quickPrompts.map((item, index) => (
            <button
              key={index}
              onClick={() => onQuickPrompt(item.prompt)}
              className="p-4 bg-gray-800/30 border border-gray-700 rounded-xl text-gray-200 cursor-pointer transition-all duration-300 text-left text-sm flex items-center gap-3 hover:bg-purple-600/15 hover:border-purple-600/40 hover:translate-x-2 hover:shadow-lg hover:shadow-purple-600/20"
            >
              <span className="text-xl">{item.icon}</span>
              <span>{item.label}</span>
            </button>
          ))}
        </div>
      </div>

      <div className="mb-8">
        <h3 className="text-xs uppercase tracking-wider text-gray-500 mb-4 flex items-center gap-2">
          <span>üìä</span> Session Stats
        </h3>
        <div className="bg-gray-800/30 border border-gray-700 rounded-xl p-4 mb-3 transition-all duration-300 hover:translate-y-[-2px] hover:shadow-lg hover:shadow-purple-600/20">
          <div className="text-xs text-gray-500 mb-2 uppercase tracking-wider">Jokes Told</div>
          <div className="text-2xl font-bold bg-gradient-to-r from-purple-600 via-purple-700 to-cyan-500 bg-clip-text text-transparent">
            {messageCount}
          </div>
        </div>
        <div className="bg-gray-800/30 border border-gray-700 rounded-xl p-4 mb-3 transition-all duration-300 hover:translate-y-[-2px] hover:shadow-lg hover:shadow-purple-600/20">
          <div className="text-xs text-gray-500 mb-2 uppercase tracking-wider">Requests Made</div>
          <div className="text-2xl font-bold bg-gradient-to-r from-purple-600 via-purple-700 to-cyan-500 bg-clip-text text-transparent">
            {apiCallCount}
          </div>
        </div>
        <div className="bg-gray-800/30 border border-gray-700 rounded-xl p-4 transition-all duration-300 hover:translate-y-[-2px] hover:shadow-lg hover:shadow-purple-600/20">
          <div className="text-xs text-gray-500 mb-2 uppercase tracking-wider">Session Time</div>
          <div className="text-2xl font-bold bg-gradient-to-r from-purple-600 via-purple-700 to-cyan-500 bg-clip-text text-transparent">
            {sessionTime}
          </div>
        </div>
      </div>

      <div className="mb-8">
        <h3 className="text-xs uppercase tracking-wider text-gray-500 mb-4 flex items-center gap-2">
          <span>üõ†Ô∏è</span> Actions
        </h3>
        <div className="flex flex-col gap-3">
          <button
            onClick={onClearChat}
            className="p-4 bg-gray-800/30 border border-gray-700 rounded-xl text-gray-200 cursor-pointer transition-all duration-300 text-sm flex items-center gap-3 hover:bg-red-600/15 hover:border-red-600/40 hover:translate-x-2 hover:shadow-lg hover:shadow-red-600/20"
          >
            <span>üóëÔ∏è</span>
            <span>Clear Conversation</span>
          </button>
          <button
            onClick={onExportChat}
            className="p-4 bg-gray-800/30 border border-gray-700 rounded-xl text-gray-200 cursor-pointer transition-all duration-300 text-sm flex items-center gap-3 hover:bg-cyan-600/15 hover:border-cyan-600/40 hover:translate-x-2 hover:shadow-lg hover:shadow-cyan-600/20"
          >
            <span>üíæ</span>
            <span>Export Jokes</span>
          </button>
        </div>
      </div>
    </aside>
  );
};

export default SidePanel;

=== pages/api/joke.js ===
export default async function handler(req, res) {
  if (req.method !== 'POST') {
    return res.status(405).json({ error: 'Method not allowed' });
  }

  const { category } = req.body;

  // Joke database
  const jokes = {
    default: [
      "Why don't scientists trust atoms? Because they make up everything!",
      "I told my wife she was drawing her eyebrows too high. She looked surprised.",
      "Why did the scarecrow win an award? He was outstanding in his field!",
      "I'm reading a book about anti-gravity. It's impossible to put down!",
      "Did you hear about the mathematician who's afraid of negative numbers? He'll stop at nothing to avoid them!",
      "Why don't eggs tell jokes? They'd crack each other up!",
      "I used to play piano by ear, but now I use my hands.",
      "Why did the bicycle fall over? Because it was two-tired!",
      "I'm on a seafood diet. I see food and I eat it!",
      "Why did the coffee file a police report? It got mugged!"
    ],
    dad: [
      "I would tell you a construction joke, but I'm still working on it.",
      "I'm afraid for the calendar. Its days are numbered.",
      "My wife said I should do lunges to stay in shape. That would be a big step forward.",
      "I don't trust stairs. They're always up to something.",
      "I used to hate facial hair, but then it grew on me.",
      "I decided to sell my vacuum cleaner. It was just gathering dust!",
      "I have a fear of speed bumps, but I'm slowly getting over it.",
      "I told my suitcase there would be no vacation this year. Now I'm dealing with emotional baggage.",
      "I used to be a baker, but I couldn't make enough dough.",
      "I'm reading a book about anti-gravity. It's impossible to put down!"
    ],
    knock: [
      "Knock, knock. Who's there? Tank. Tank who? You're welcome!",
      "Knock, knock. Who's there? Alpaca. Alpaca who? Alpaca the suitcase, you load up the car!",
      "Knock, knock. Who's there? Cows go. Cows go who? No, cows go MOO!",
      "Knock, knock. Who's there? Dozen. Dozen who? Dozen anyone want to let me in?",
      "Knock, knock. Who's there? Lettuce. Lettuce who? Lettuce in, it's cold out here!",
      "Knock, knock. Who's there? Orange. Orange who? Orange you glad I didn't say banana?",
      "Knock, knock. Who's there? Boo. Boo who? Don't cry, it's just a joke!",
      "Knock, knock. Who's there? Honey bee. Honey bee who? Honey bee a dear and get me some water!",
      "Knock, knock. Who's there? Ice cream. Ice cream who? Ice cream if you don't let me in!",
      "Knock, knock. Who's there? Atch. Atch who? Bless you!"
    ],
    office: [
      "Why did the employee get fired from the calendar factory? He took a couple of days off!",
      "My boss told me to have a good day. So I went home!",
      "Why don't skeletons like going to office parties? They have no body to dance with!",
      "I told my computer I needed a break, and now it won't stop sending me Kit-Kat ads!",
      "Why did the scarecrow get promoted? He was outstanding in his field!",
      "My boss is like a diaper, always on my butt and full of crap!",
      "Why did the employee bring a ladder to work? He heard the job was a high-level position!",
      "I asked my boss for a raise, but he said I was already raised!",
      "Why don't office workers ever play hide and seek? Because good luck hiding when your boss can see your screen!",
      "My office has a 'casual Friday', but I still show up in my pajamas. It doesn't get more casual than that!"
    ],
    animal: [
      "What do you call a fake noodle? An impasta!",
      "Why don't cats play poker in the jungle? Too many cheetahs!",
      "What do you call a sleeping bull? A bulldozer!",
      "Why did the turkey cross the road twice? To prove he wasn't chicken!",
      "What do you call a fish with no eyes? A fsh!",
      "Why are fish so smart? Because they live in schools!",
      "What do you get when you cross a snowman and a vampire? Frostbite!",
      "Why don't elephants use computers? They're afraid of the mouse!",
      "What do you call a bear with no teeth? A gummy bear!",
      "Why did the dog sit in the shade? Because he didn't want to be a hot dog!"
    ],
    tech: [
      "Why do programmers prefer dark mode? Because light attracts bugs!",
      "Why do Java developers wear glasses? Because they can't C#!",
      "A SQL query walks into a bar, walks up to two tables and asks, 'Can I join you?'",
      "Why was the JavaScript developer sad? Because he didn't Node how to Express himself!",
      "Why do programmers always mix up Halloween and Christmas? Because Oct 31 equals Dec 25!",
      "Why did the developer go broke? Because he used up all his cache!",
      "Why was the function sad after being called? It didn't return anything!",
      "What's a pirate's favorite programming language? Python!",
      "Why don't programmers like nature? It has too many bugs!",
      "What do you call a programmer from Finland? Nerdic!"
    ],
    food: [
      "Why did the tomato turn red? Because it saw the salad dressing!",
      "What do you call a fake noodle? An impasta!",
      "Why don't eggs tell jokes? They'd crack each other up!",
      "What do you call cheese that isn't yours? Nacho cheese!",
      "Why did the cookie go to the doctor? Because it felt crumbly!",
      "What's a taco's favorite dance? The salsa!",
      "Why did the banana go to the doctor? It wasn't peeling well!",
      "What do you call a sad strawberry? A blueberry!",
      "Why was the soup so good? It had a lot of thyme!",
      "What do you call a bear with no teeth? A gummy bear!"
    ]
  };

  // Determine which category to use
  let categoryJokes = jokes.default;
  if (category) {
    const lowerCategory = category.toLowerCase();
    if (lowerCategory.includes('dad')) categoryJokes = jokes.dad;
    else if (lowerCategory.includes('knock')) categoryJokes = jokes.knock;
    else if (lowerCategory.includes('office') || lowerCategory.includes('work')) categoryJokes = jokes.office;
    else if (lowerCategory.includes('animal')) categoryJokes = jokes.animal;
    else if (lowerCategory.includes('tech') || lowerCategory.includes('nerd') || lowerCategory.includes('programmer')) categoryJokes = jokes.tech;
    else if (lowerCategory.includes('food')) categoryJokes = jokes.food;
  }

  // Select a random joke
  const randomJoke = categoryJokes[Math.floor(Math.random() * categoryJokes.length)];

  // Simulate processing delay
  await new Promise(resolve => setTimeout(resolve, 1000));

  res.status(200).json({ joke: randomJoke });
}

=== pages/index.js ===
import React, { useState, useEffect, useRef } from 'react';
import Message from '../components/Message';
import TypingIndicator from '../components/TypingIndicator';
import Header from '../components/Header';
import SidePanel from '../components/SidePanel';

export default function Home() {
  const [messages, setMessages] = useState([
    {
      text: "üé≠ Welcome to AI Joke Assistant! I'm here to make you laugh! Click any joke category in the side panel or just ask me for a joke. Ready to have some fun? üòÑ",
      sender: 'bot',
      time: 'Just now'
    }
  ]);
  const [inputText, setInputText] = useState('');
  const [isTyping, setIsTyping] = useState(false);
  const [messageCount, setMessageCount] = useState(1);
  const [apiCallCount, setApiCallCount] = useState(0);
  const [sessionTime, setSessionTime] = useState('0:00');
  const [isConnected, setIsConnected] = useState(true);
  const messagesEndRef = useRef(null);
  const sessionStartTime = useRef(Date.now());

  // Auto scroll to bottom
  useEffect(() => {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  }, [messages]);

  // Update session time
  useEffect(() => {
    const timer = setInterval(() => {
      const elapsed = Math.floor((Date.now() - sessionStartTime.current) / 1000);
      const minutes = Math.floor(elapsed / 60);
      const seconds = elapsed % 60;
      setSessionTime(`${minutes}:${seconds.toString().padStart(2, '0')}`);
    }, 1000);

    return () => clearInterval(timer);
  }, []);

  const speakText = (text) => {
    if ('speechSynthesis' in window) {
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.rate = 0.9;
      utterance.pitch = 1;
      speechSynthesis.speak(utterance);
    }
  };

  const getCurrentTime = () => {
    return new Date().toLocaleTimeString('en-US', { 
      hour: '2-digit', 
      minute: '2-digit' 
    });
  };

  const addMessage = (text, sender) => {
    const newMessage = {
      text,
      sender,
      time: getCurrentTime()
    };
    setMessages(prev => [...prev, newMessage]);
    if (sender === 'user') {
      setMessageCount(prev => prev + 1);
    }
  };

  const sendMessage = async () => {
    if (!inputText.trim()) return;

    const userMessage = inputText.trim();
    addMessage(userMessage, 'user');
    setInputText('');
    setIsTyping(true);

    try {
      const response = await fetch('/api/joke', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ category: userMessage }),
      });

      if (!response.ok) {
        throw new Error('Failed to fetch joke');
      }

      const data = await response.json();
      addMessage(data.joke, 'bot');
      setApiCallCount(prev => prev + 1);
    } catch (error) {
      addMessage("Oops! I couldn't fetch a joke right now. Try again in a moment! üòÖ", 'bot');
    } finally {
      setIsTyping(false);
    }
  };

  const handleQuickPrompt = (prompt) => {
    setInputText(prompt);
    setTimeout(() => sendMessage(), 100);
  };

  const clearChat = () => {
    setMessages([{
      text: "üé≠ Fresh start! Ready for more jokes? I've got plenty! üòÑ",
      sender: 'bot',
      time: getCurrentTime()
    }]);
    setMessageCount(1);
    setApiCallCount(0);
    sessionStartTime.current = Date.now();
  };

  const exportChat = () => {
    const chatText = messages.map(msg => 
      `${msg.sender.toUpperCase()}: ${msg.text}`
    ).join('\n\n');
    
    const blob = new Blob([chatText], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'jokes-export.txt';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  };

  const handleKeyPress = (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
  };

  return (
    <div className="min-h-screen bg-gray-900 relative">
      <div className="bg-animation"></div>
      
      <Header isConnected={isConnected} />

      <div className="max-w-7xl mx-auto h-[calc(100vh-88px)] flex p-6 gap-6">
        <main className="flex-1 flex flex-col bg-gray-800/95 backdrop-blur-lg rounded-2xl border border-gray-700 overflow-hidden shadow-lg shadow-purple-600/15">
          <div className="flex-1 overflow-y-auto p-6 custom-scrollbar">
            {messages.map((message, index) => (
              <Message
                key={index}
                {...message}
                onSpeak={speakText}
              />
            ))}
            {isTyping && <TypingIndicator />}
            <div ref={messagesEndRef} />
          </div>

          <div className="p-6 border-t border-gray-700 bg-gray-800/95">
            <div className="flex gap-3 items-end">
              <div className="flex-1 relative">
                <textarea
                  value={inputText}
                  onChange={(e) => setInputText(e.target.value)}
                  onKeyPress={handleKeyPress}
                  placeholder="Ask me for a joke or choose a category! üòÑ"
                  className="w-full p-4 bg-gray-800/30 border-2 border-gray-700 rounded-full text-gray-200 resize-none transition-all duration-300 min-h-[55px] max-h-[140px] focus:border-purple-600 focus:bg-gray-800/50 focus:shadow-lg focus:shadow-purple-600/30"
                  rows={1}
                  maxLength={500}
                />
                <span className="absolute bottom-[-22px] right-4 text-xs text-gray-500">
                  {inputText.length}/500
                </span>
              </div>
              <div className="flex gap-3">
                <button
                  onClick={() => speakText(inputText)}
                  className="w-14 h-14 rounded-full bg-gray-800/30 border-2 border-gray-700 text-gray-400 hover:bg-cyan-600/20 hover:border-cyan-500 hover:text-cyan-400 transition-all duration-300 flex items-center justify-center text-xl"
                  title="Speak Input"
                >
                  üîä
                </button>
                <button
                  onClick={sendMessage}
                  disabled={!inputText.trim() || isTyping}
                  className="w-14 h-14 rounded-full bg-gradient-to-br from-purple-600 via-purple-700 to-cyan-500 text-white shadow-lg shadow-purple-600/40 hover:shadow-xl hover:shadow-purple-600/60 hover:scale-110 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center text-xl"
                  title="Send Message"
                >
                  ‚û§
                </button>
              </div>
            </div>
          </div>
        </main>

        <SidePanel
          messageCount={messageCount}
          apiCallCount={apiCallCount}
          sessionTime={sessionTime}
          onQuickPrompt={handleQuickPrompt}
          onClearChat={clearChat}
          onExportChat={exportChat}
        />
      </div>
    </div>
  );
}